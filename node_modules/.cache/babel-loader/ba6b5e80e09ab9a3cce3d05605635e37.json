{"ast":null,"code":"var _jsxFileName = \"/Users/rapyd_academy/Desktop/rapyd_academy/tokens-proj-clientSide/react-client/src/App.js\";\nimport React, { useState, useEffect } from 'react';\nimport logo from \"./logo.svg\";\nimport './App.css';\nimport * as api from './api';\nimport { FaFacebookF, FaGithub } from 'react-icons/fa';\nimport qs from 'query-string';\n\nfunction App() {\n  const [authenticated, set_authenticated] = useState(false);\n  const [loading, set_loading] = useState(false);\n  const [user, set_user] = useState(null);\n  const [access_token, set_access_token] = useState(null);\n  const [content, set_content] = useState('no content yet...');\n  useEffect(() => {\n    if (window.location.search && window.location.search.includes('token')) {\n      console.log('search - ', window.location.search);\n      const search = qs.parse(window.location.search);\n      console.log('qs - ', search);\n      const profile = JSON.parse(search.profile);\n      const {\n        token\n      } = search;\n      console.log('profile - ', profile);\n      console.log('token - ', token);\n\n      if (profile && token) {\n        set_authenticated(true);\n        set_user(profile); //  localStorage.setItem('token',token) //not secure\n\n        set_access_token(token); //store access_token in-memory\n        //remove query string and path from url...\n\n        window.history.replaceState({}, document.title, \"/\");\n      }\n    } else if (!access_token) {\n      //ask access_token from server, in case refresh_token already exists as an httpOnly cookie\n      const get_access = async () => {\n        const response = await api.get_access_token();\n\n        if ('access_token' in response && 'profile' in response) {\n          set_access_token(response.access_token);\n          set_authenticated(true);\n          set_user(JSON.parse(response.profile));\n        } else {\n          alert('please login');\n        }\n      };\n\n      get_access();\n    }\n  }, [access_token]);\n\n  const connect = provider => {\n    set_loading(true);\n    window.location.href = `http://localhost:3030/api/auth/${provider}`;\n  };\n\n  const logout = async _ => {\n    const response = await api.logout();\n\n    if (response.message === 'You are logged out') {\n      set_authenticated(false);\n      set_user(null); // localStorage.removeItem('token') //not secure\n\n      set_access_token(null);\n    }\n  };\n\n  const get_protected = async _ => {\n    //const token = localStorage.getItem('token') //not secure\n    const token = access_token;\n    const response = await api.get_protected({\n      token\n    });\n    set_content(response.payload);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"header\", {\n    className: \"App-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 11\n    }\n  }, \"Auth demo\"), /*#__PURE__*/React.createElement(\"img\", {\n    src: logo,\n    className: \"logo\",\n    alt: \"logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 9\n    }\n  }, \"Authenticated:\", /*#__PURE__*/React.createElement(\"span\", {\n    className: \"lightblue-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 26\n    }\n  }, ' ' + authenticated)), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 9\n    }\n  }, \"Loading:\", /*#__PURE__*/React.createElement(\"span\", {\n    className: \"lightblue-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 20\n    }\n  }, ' ' + loading)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profile-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }\n  }, user && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  }, user.name), /*#__PURE__*/React.createElement(\"img\", {\n    className: \"profile-img\",\n    src: user && user.photo,\n    alt: \"avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"buttons-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }, authenticated ? /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn\",\n    onClick: logout,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 11\n    }\n  }, \"Logout\") : /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"oauth-btn\",\n    onClick: () => connect('github'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FaGithub, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 78\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"oauth-btn\",\n    onClick: () => connect('facebook'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FaFacebookF, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 80\n    }\n  }))), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn\",\n    onClick: get_protected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 11\n    }\n  }, \"get protected content\")), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }\n  }, content)));\n}\n\nexport default App; //:<button className=\"btn\" onClick={login}>Login</button>}","map":{"version":3,"sources":["/Users/rapyd_academy/Desktop/rapyd_academy/tokens-proj-clientSide/react-client/src/App.js"],"names":["React","useState","useEffect","api","FaFacebookF","FaGithub","qs","App","authenticated","set_authenticated","loading","set_loading","user","set_user","access_token","set_access_token","content","set_content","window","location","search","includes","console","log","parse","profile","JSON","token","history","replaceState","document","title","get_access","response","get_access_token","alert","connect","provider","href","logout","_","message","get_protected","payload","logo","name","photo"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport * as api from './api';\nimport {FaFacebookF,FaGithub} from 'react-icons/fa'\nimport qs from 'query-string'\n\nfunction App() {\n  const [authenticated,set_authenticated] = useState(false);\n  const [loading,set_loading] = useState(false);\n  const [user,set_user] = useState(null);\n  const [access_token,set_access_token] = useState(null);\n  const [content,set_content] = useState('no content yet...');\n\n  useEffect(()=>{\n    if(window.location.search && window.location.search.includes('token')){\n      console.log('search - ',window.location.search)\n      const search = qs.parse(window.location.search);\n      console.log('qs - ',search)\n      const profile = JSON.parse(search.profile)\n      const {token} = search\n      console.log('profile - ',profile)\n      console.log('token - ',token)\n      if(profile && token){\n       set_authenticated(true)\n       set_user(profile)\n       //  localStorage.setItem('token',token) //not secure\n       set_access_token(token) //store access_token in-memory\n \n       //remove query string and path from url...\n       window.history.replaceState({}, document.title, \"/\");\n      }\n    }else if(!access_token){\n      //ask access_token from server, in case refresh_token already exists as an httpOnly cookie\n      const get_access = async ()=> {\n          const response = await api.get_access_token();\n          if('access_token' in response && 'profile' in response){\n            set_access_token(response.access_token);\n            set_authenticated(true);\n            set_user(JSON.parse(response.profile))\n          }else{\n            alert('please login')\n          }\n      }\n      get_access()\n    }\n  },[access_token])\n\n  const connect = provider =>{\n     set_loading(true)\n     window.location.href = `http://localhost:3030/api/auth/${provider}`;  \n  }\n\n  const logout = async _ =>{\n    const response = await api.logout()\n    if(response.message === 'You are logged out'){\n      set_authenticated(false)\n      set_user(null)\n      // localStorage.removeItem('token') //not secure\n      set_access_token(null)\n    }\n  }\n  const get_protected = async _ =>{\n    //const token = localStorage.getItem('token') //not secure\n    const token = access_token;\n    const response = await api.get_protected({token})\n    set_content(response.payload)\n  }\n  \n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <div className=\"top-box\">\n          <h1>Auth demo</h1>\n          <img src={logo} className=\"logo\" alt=\"logo\" />\n        </div>\n        \n        <p>Authenticated:<span className=\"lightblue-text\">{' '+authenticated}</span></p>\n        <p>Loading:<span className=\"lightblue-text\">{' '+loading}</span></p>\n        <div className=\"profile-box\">\n          {user && <>\n            <p>{user.name}</p>\n            <img className=\"profile-img\" src={user && user.photo} alt=\"avatar\" />\n            </>}\n        </div>\n        <div className=\"buttons-box\">\n          {authenticated?\n          <button className=\"btn\" onClick={logout}>Logout</button>\n          : <div>\n              <button className=\"oauth-btn\" onClick={()=> connect('github')}><FaGithub/></button>\n              <button className=\"oauth-btn\" onClick={()=> connect('facebook')}><FaFacebookF/></button>\n            </div>\n          }\n          <button className=\"btn\" onClick={get_protected}>get protected content</button>\n        </div>\n        <p className=\"content\">{content}</p>\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n\n//:<button className=\"btn\" onClick={login}>Login</button>}"]},"metadata":{},"sourceType":"module"}